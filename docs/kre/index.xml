<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Konstellation – KAI Server</title><link>https://www.konstellation.io/docs/kre/</link><description>Recent content in KAI Server on Konstellation</description><generator>Hugo -- gohugo.io</generator><language>en-us</language><atom:link href="https://www.konstellation.io/docs/kre/index.xml" rel="self" type="application/rss+xml"/><item><title>Docs: Getting Started</title><link>https://www.konstellation.io/docs/kre/getting_started/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://www.konstellation.io/docs/kre/getting_started/</guid><description/></item><item><title>Docs: Operator documentation</title><link>https://www.konstellation.io/docs/kre/operator/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://www.konstellation.io/docs/kre/operator/</guid><description/></item><item><title>Docs: User</title><link>https://www.konstellation.io/docs/kre/user/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://www.konstellation.io/docs/kre/user/</guid><description/></item><item><title>Docs: KAI Server Training</title><link>https://www.konstellation.io/docs/kre/training/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://www.konstellation.io/docs/kre/training/</guid><description>
&lt;p>The &lt;a href="https://github.com/konstellation-io/kai-server-training">Kai Server Training repo&lt;/a> is a training exercise designed
to introduce new users to the usage and development of KRT projects. You can use the training exercise to build and
deploy your first KRT project and also to reverse engineer it and learn how to develop your own projects.&lt;/p>
&lt;h2 id="introduction">Introduction&lt;/h2>
&lt;p>This example consists of a workflow called &lt;em>Descriptor&lt;/em> that will print information of a given GitHub repository, being
this info its last GitHub and Dockerhub tag released. The workflow is made up of 3 different nodes, each one in charge
of a different process through the pipeline:&lt;/p>
&lt;ul>
&lt;li>&lt;strong>ETL&lt;/strong>: This node will accept incoming requests and prepare a new info struct to be filled.&lt;/li>
&lt;li>&lt;strong>GitHub&lt;/strong>: This node will search for the GitHub information of the repo then fill the info struct with it if found.&lt;/li>
&lt;li>&lt;strong>Dockerhub&lt;/strong>: This node will search for the Dockerhub information of the repo then fill the info struct with it if found.&lt;/li>
&lt;/ul>
&lt;p>All nodes also save metrics to the InfluxDB instance as an example of metric handling.&lt;/p>
&lt;h2 id="how-to-deploy">How to deploy&lt;/h2>
&lt;p>You can find information about building and deployment within the repo&amp;rsquo;s &lt;code>readme&lt;/code> file.&lt;/p>
&lt;h2 id="how-to-use">How to use&lt;/h2>
&lt;p>Once deployed the generated KRT file, you can open an entrypoint to your local pod. However, to easy up usage, we&amp;rsquo;ve
placed some helping scripts inside a folder called &lt;code>scripts&lt;/code>, you can find information about usage within the &lt;code>readme&lt;/code>
file placed inside this directory as well.&lt;/p>
&lt;h2 id="descriptor-example">Descriptor example&lt;/h2>
&lt;div class="card rounded p-2 td-post-card mb-4 mt-4" style="max-width: 1010px">
&lt;img class="card-img-top" src="https://www.konstellation.io/docs/kre/training/kai-training-example_hua90e230fb7082f978b2864057d1fc7f2_74540_1000x0_resize_catmullrom_2.png" width="1000" height="598">
&lt;/div>
&lt;h3 id="result-example">Result example&lt;/h3>
&lt;div class="card rounded p-2 td-post-card mb-4 mt-4" style="max-width: 1010px">
&lt;img class="card-img-top" src="https://www.konstellation.io/docs/kre/training/kai-training-result-example_hu1dd8b0ca66cb84e1f146586f3b5ae250_41479_1000x0_resize_catmullrom_2.png" width="1000" height="210">
&lt;/div>
&lt;h2 id="step-by-step-guide">Step-by-step guide&lt;/h2>
&lt;p>This step-by-step guide will aid you create a new Konstellation version for your project, which will help you understand
all the main KAI Server concepts and test KAI Server functions.&lt;/p>
&lt;h3 id="1-create-the-version-structure-based-on-the-krt-template">1. Create the version structure based on the krt-template&lt;/h3>
&lt;p>Start by creating an empty project with the following folders and files:&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash"> project
└───docs
&lt;span style="color:#000;font-weight:bold">|&lt;/span> └───README.md &lt;span style="color:#8f5902;font-style:italic"># Documentation shown inside KAI Server&lt;/span>
│
└───models &lt;span style="color:#8f5902;font-style:italic"># If the process needs a model to do the inference&lt;/span>
│
└───src &lt;span style="color:#8f5902;font-style:italic"># Source code of each node&lt;/span>
│ └───etl
│ └───github
│ └───dockerhub
&lt;span style="color:#000;font-weight:bold">|&lt;/span>
└─── metrics
│ └───dashboards
&lt;span style="color:#000;font-weight:bold">|&lt;/span>
&lt;span style="color:#000;font-weight:bold">|&lt;/span> krt.yml &lt;span style="color:#8f5902;font-style:italic"># krt manifest&lt;/span>
&lt;span style="color:#000;font-weight:bold">|&lt;/span> public_input.proto &lt;span style="color:#8f5902;font-style:italic"># proto defining entrypoint Services and Messages.&lt;/span>
&lt;span style="color:#000;font-weight:bold">|&lt;/span> internal_nodes.proto &lt;span style="color:#8f5902;font-style:italic"># proto defining Messages that interconnect nodes.&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="2-fill-the-krtyml">2. Fill the &lt;code>krt.yml&lt;/code>&lt;/h3>
&lt;p>More information can be found &lt;a href="https://www.konstellation.io/docs/kre/user/40_krt/">here&lt;/a>.&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">version&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>descriptor-v2&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">description&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>Version&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>for&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>testing.&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">entrypoint&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">proto&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>public_input.proto&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">image&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>konstellation/kre-entrypoint&lt;span style="color:#000;font-weight:bold">:&lt;/span>latest&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">config&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">variables&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>- GITHUB_ENABLED&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>- DOCKERHUB_ENABLED&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">nodes&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>- &lt;span style="color:#204a87;font-weight:bold">name&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>etl&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">image&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>konstellation/kre-go&lt;span style="color:#000;font-weight:bold">:&lt;/span>latest&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">src&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>bin/etl&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#8f5902;font-style:italic"># gpu is an optional value, defaults to false.&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">gpu&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">false&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>- &lt;span style="color:#204a87;font-weight:bold">name&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>github&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">image&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>konstellation/kre-go&lt;span style="color:#000;font-weight:bold">:&lt;/span>latest&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">src&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>bin/github&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#8f5902;font-style:italic"># gpu is an optional value, defaults to false.&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">gpu&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">false&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>- &lt;span style="color:#204a87;font-weight:bold">name&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>dockerhub&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">image&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>konstellation/kre-go&lt;span style="color:#000;font-weight:bold">:&lt;/span>latest&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">src&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>bin/dockerhub&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#8f5902;font-style:italic"># gpu is an optional value, defaults to false.&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">gpu&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">false&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">workflows&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>- &lt;span style="color:#204a87;font-weight:bold">name&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>go-descriptor&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">entrypoint&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>GoDescriptor&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">sequential&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>- etl&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>- github&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>- dockerhub&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="3-fill-the-protobuf-files">3. Fill the protobuf files&lt;/h3>
&lt;h4 id="public_inputproto">public_input.proto&lt;/h4>
&lt;p>This file will be used to define the public nodes&amp;rsquo; data contract and should contain the following info:&lt;/p>
&lt;ul>
&lt;li>&lt;code>Request&lt;/code> message: main entrypoint entrance.&lt;/li>
&lt;li>&lt;code>GithubInfo&lt;/code> message: Data structure for the GitHub info.&lt;/li>
&lt;li>&lt;code>DockerhubInfo&lt;/code> message: Data structure for the Dockerhub info.&lt;/li>
&lt;li>&lt;code>Response&lt;/code> message: Final response.&lt;/li>
&lt;li>&lt;code>Entrypoint&lt;/code> service that routes to the first node and returns a &lt;code>Response&lt;/code> message.&lt;/li>
&lt;/ul>
&lt;h4 id="internal_nodesproto">internal_nodes.proto&lt;/h4>
&lt;p>This second protobuf file defines the data contract for the internal nodes. It follows the same approach of the &lt;code>public_input.proto&lt;/code> file to generate the following resources:&lt;/p>
&lt;ul>
&lt;li>&lt;code>EtlOutput&lt;/code> message: Output of the ETL node.&lt;/li>
&lt;li>&lt;code>GithubOutput&lt;/code> message: Output of the GitHub node.&lt;/li>
&lt;/ul>
&lt;p>Keep in mind that in order to properly create the &lt;code>GithubOutput&lt;/code> message, it&amp;rsquo;s necessary to import the &lt;code>GithubInfo&lt;/code> message from the &lt;code>public_input.proto&lt;/code> file.&lt;/p>
&lt;h3 id="4-develop-the-nodes">4. Develop the nodes&lt;/h3>
&lt;p>Nodes are defined isolated from each other in the &lt;code>src&lt;/code> directory.&lt;/p>
&lt;ol>
&lt;li>Create a new empty directory in &lt;code>src&lt;/code>&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-sh" data-lang="sh">mkdir node-name
&lt;/code>&lt;/pre>&lt;/div>&lt;ol start="2">
&lt;li>Initialize the directory as Go project&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-sh" data-lang="sh">go mod init node-name
&lt;/code>&lt;/pre>&lt;/div>&lt;ol start="3">
&lt;li>Create a &lt;code>main.go&lt;/code> as the entrypoint of the code&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-sh" data-lang="sh">touch main.go
&lt;/code>&lt;/pre>&lt;/div>&lt;ol start="4">
&lt;li>Define &lt;code>init&lt;/code> and &lt;code>handler&lt;/code> functions explained &lt;a href="https://www.konstellation.io/docs/kre/user/50_kais_runner_sdk/">here&lt;/a>&lt;/li>
&lt;/ol>
&lt;p>The code inside a node can be organized in many ways to keep the best clean code practices, but the root directory
should have a &lt;code>main.go&lt;/code> file with the &lt;code>init&lt;/code> and &lt;code>handler&lt;/code> functions.&lt;/p>
&lt;p>As this training exercise is based in creating a GitHub and DockerHub descriptor (a tool to get what are the latest
versions updated to GitHub and DockerHub of a component.), it will be necessary to create the following nodes:&lt;/p>
&lt;ul>
&lt;li>ETL: This node is in charge of processing the data passed in the entrypoint and follows the structure below:&lt;/li>
&lt;/ul>
&lt;pre>&lt;code> etl
└───go.mod
└───go.sum
└───main.go
└───public_input.pb.go
&lt;/code>&lt;/pre>&lt;ul>
&lt;li>GitHub: This node is in charge of checking the latest version of the selected Konstellation repository.&lt;/li>
&lt;/ul>
&lt;pre>&lt;code> github
└───dockerhubservice
| └───mocks_service.go
| └───service.go
└───go.mod
└───go.sum
└───main.go
└───main_test.go
└───public_input.pb.go
&lt;/code>&lt;/pre>&lt;ul>
&lt;li>Dockerhub: This node is in charge of checking the latest image uploaded to the selected Dockerhub repository.&lt;/li>
&lt;/ul>
&lt;pre>&lt;code> dockerhub
└───dockerhubservice
| └───mocks_service.go
| └───service.go
└───go.mod
└───go.sum
└───main.go
└───main_test.go
└───public_input.pb.go
&lt;/code>&lt;/pre>&lt;p>After creating the nodes folders, the next step is to compile the protobuf files and generate the &lt;code>public_input.proto&lt;/code>
file inside each node folder, using the following command:&lt;/p>
&lt;pre>&lt;code> protoc -I=./descriptor \
--go_out=descriptor/src/etl \
--go_out=descriptor/src/github \
--go_out=descriptor/src/dockerhub \
--go_opt=paths=source_relative descriptor/public_input.proto
&lt;/code>&lt;/pre>&lt;p>Once the protobuf files are compiled, you can start coding the nodes.&lt;/p>
&lt;blockquote>
&lt;p>The full content of the nodes and protobuf files can be found &lt;a href="https://github.com/konstellation-io/kai-server-training/tree/docs/descriptor/src">here&lt;/a>&lt;/p>
&lt;/blockquote>
&lt;h3 id="5-build-the-krt-file">5. Build the .krt file&lt;/h3>
&lt;p>In order to upload a new version to the KAI Server, it&amp;rsquo;s necessary to create a .krt file that contains all the required
files. This file can be created with the following script:&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">&lt;span style="color:#8f5902;font-style:italic">#!/bin/bash
&lt;/span>&lt;span style="color:#8f5902;font-style:italic">&lt;/span>
&lt;span style="color:#8f5902;font-style:italic"># shellcheck disable=SC2086&lt;/span>
&lt;span style="color:#8f5902;font-style:italic">## USAGE:&lt;/span>
&lt;span style="color:#8f5902;font-style:italic"># ./build_krt.sh &amp;lt;new-version-name&amp;gt;&lt;/span>
&lt;span style="color:#204a87">set&lt;/span> -eu
&lt;span style="color:#000">VERSION_DIR&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;descriptor&amp;#34;&lt;/span>
&lt;span style="color:#8f5902;font-style:italic"># NOTE: if yq commands fails it due to the awesome Snap installation that is confined (heavily restricted).&lt;/span>
&lt;span style="color:#8f5902;font-style:italic"># Please install yq binary from https://github.com/mikefarah/yq/releases and think twice before using Snap next time.&lt;/span>
&lt;span style="color:#204a87">echo&lt;/span> -e &lt;span style="color:#4e9a06">&amp;#34;Reading current version: \c&amp;#34;&lt;/span>
&lt;span style="color:#000">CURRENT_VERSION&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span>&lt;span style="color:#204a87;font-weight:bold">$(&lt;/span>yq e .version &lt;span style="color:#4e9a06">${&lt;/span>&lt;span style="color:#000">VERSION_DIR&lt;/span>&lt;span style="color:#4e9a06">}&lt;/span>/krt.yml&lt;span style="color:#204a87;font-weight:bold">)&lt;/span>
&lt;span style="color:#204a87">echo&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;&lt;/span>&lt;span style="color:#4e9a06">${&lt;/span>&lt;span style="color:#000">CURRENT_VERSION&lt;/span>&lt;span style="color:#4e9a06">}&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;&lt;/span>
&lt;span style="color:#000">VERSION&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span>&lt;span style="color:#4e9a06">${&lt;/span>&lt;span style="color:#000">VERSION_DIR&lt;/span>&lt;span style="color:#4e9a06">}&lt;/span>-&lt;span style="color:#4e9a06">${&lt;/span>&lt;span style="color:#000">1&lt;/span>&lt;span style="color:#204a87;font-weight:bold">:-&lt;/span>&lt;span style="color:#4e9a06">${&lt;/span>&lt;span style="color:#000">CURRENT_VERSION&lt;/span>&lt;span style="color:#000;font-weight:bold">#&lt;/span>&lt;span style="color:#000">$VERSION_DIR&lt;/span>&lt;span style="color:#000;font-weight:bold">-&lt;/span>&lt;span style="color:#4e9a06">}}&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">if&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">[&lt;/span> -z &lt;span style="color:#4e9a06">&amp;#34;&lt;/span>&lt;span style="color:#000">$VERSION&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">]&lt;/span>&lt;span style="color:#000;font-weight:bold">;&lt;/span> &lt;span style="color:#204a87;font-weight:bold">then&lt;/span>
&lt;span style="color:#204a87">echo&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;error setting KRT version&amp;#34;&lt;/span>
&lt;span style="color:#204a87">exit&lt;/span> 1&lt;span style="color:#000;font-weight:bold">;&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">fi&lt;/span>
&lt;span style="color:#204a87">echo&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;Building ETL node Golang binary...&amp;#34;&lt;/span>
&lt;span style="color:#204a87">cd&lt;/span> descriptor/src/etl
go build -o ../../bin/etl .
&lt;span style="color:#204a87">echo&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;Building Github node Golang binary...&amp;#34;&lt;/span>
&lt;span style="color:#204a87">cd&lt;/span> ../github
go build -o ../../bin/github .
&lt;span style="color:#204a87">echo&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;Building Dockerhub node Golang binary...&amp;#34;&lt;/span>
&lt;span style="color:#204a87">cd&lt;/span> ../dockerhub
go build -o ../../bin/dockerhub .
&lt;span style="color:#204a87">cd&lt;/span> ../../..
&lt;span style="color:#204a87">echo&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;Generating &lt;/span>&lt;span style="color:#000">$VERSION&lt;/span>&lt;span style="color:#4e9a06">.krt...&amp;#34;&lt;/span>
mkdir -p build/&lt;span style="color:#4e9a06">${&lt;/span>&lt;span style="color:#000">VERSION_DIR&lt;/span>&lt;span style="color:#4e9a06">}&lt;/span>
rm ./build/&lt;span style="color:#4e9a06">${&lt;/span>&lt;span style="color:#000">VERSION_DIR&lt;/span>&lt;span style="color:#4e9a06">}&lt;/span>/&lt;span style="color:#ce5c00;font-weight:bold">{&lt;/span>docs,src,assets,models,*.proto,*.yml&lt;span style="color:#ce5c00;font-weight:bold">}&lt;/span> -rf
&lt;span style="color:#204a87">cd&lt;/span> build/&lt;span style="color:#4e9a06">${&lt;/span>&lt;span style="color:#000">VERSION_DIR&lt;/span>&lt;span style="color:#4e9a06">}&lt;/span>
cp -r ../../&lt;span style="color:#4e9a06">${&lt;/span>&lt;span style="color:#000">VERSION_DIR&lt;/span>&lt;span style="color:#4e9a06">}&lt;/span>/* .
yq &lt;span style="color:#204a87">eval&lt;/span> --inplace -- &lt;span style="color:#4e9a06">&amp;#34;.version = \&amp;#34;&lt;/span>&lt;span style="color:#4e9a06">${&lt;/span>&lt;span style="color:#000">VERSION&lt;/span>&lt;span style="color:#4e9a06">}&lt;/span>&lt;span style="color:#4e9a06">\&amp;#34;&amp;#34;&lt;/span> ./krt.yml
tar -zcf ../&lt;span style="color:#4e9a06">${&lt;/span>&lt;span style="color:#000">VERSION&lt;/span>&lt;span style="color:#4e9a06">}&lt;/span>.krt --exclude&lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span>*.krt --exclude&lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span>*.tar.gz *
&lt;span style="color:#204a87">cd&lt;/span> ../../
rm build/&lt;span style="color:#4e9a06">${&lt;/span>&lt;span style="color:#000">VERSION_DIR&lt;/span>&lt;span style="color:#4e9a06">}&lt;/span> -rf
&lt;span style="color:#204a87">echo&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;Done&amp;#34;&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="6-deploy-and-test-the-new-version">6. Deploy and test the new version&lt;/h3>
&lt;p>Once the .krt file is created, it can be uploaded to KAI Server.&lt;/p>
&lt;figure>
&lt;img src="https://www.konstellation.io/docs/static/upload_version.png" width="1000px"/>
&lt;/figure>
&lt;p>Finally, in order to test the new version, you can use the &lt;a href="">run_test.sh&lt;/a> script as follows:&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">run_test.sh &amp;lt;NAMESPACE&amp;gt; &amp;lt;VERSION_NAME&amp;gt; &amp;lt;WORKFLOW&amp;gt; &amp;lt;NUM_MSGS&amp;gt; &amp;lt;REQUESTED_COMPONENT&amp;gt;
&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>Example&lt;/strong>: For our namespace &lt;code>kre&lt;/code> and a krt version &lt;code>descriptor-v1&lt;/code>, you can try out these commands:&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">./scripts/run_test.sh kre descriptor-v1 GoDescriptor &lt;span style="color:#0000cf;font-weight:bold">1&lt;/span> konstellation-io/kre
./scripts/run_test.sh kre descriptor-v1 GoDescriptor &lt;span style="color:#0000cf;font-weight:bold">1&lt;/span> konstellation-io/kdl-server
&lt;/code>&lt;/pre>&lt;/div></description></item></channel></rss>
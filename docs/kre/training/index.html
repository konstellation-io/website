<!doctype html><html lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.74.3"><meta name=ROBOTS content="NOINDEX, NOFOLLOW"><link rel=alternate type=application/rss+xml href=https://www.konstellation.io/docs/kre/training/index.xml><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>KAI Server Training | Konstellation</title><meta property="og:title" content="KAI Server Training"><meta property="og:description" content="KAI Server Training Project"><meta property="og:type" content="website"><meta property="og:url" content="https://www.konstellation.io/docs/kre/training/"><meta property="og:site_name" content="Konstellation"><meta itemprop=name content="KAI Server Training"><meta itemprop=description content="KAI Server Training Project"><meta name=twitter:card content="summary"><meta name=twitter:title content="KAI Server Training"><meta name=twitter:description content="KAI Server Training Project"><link rel=preload href=/scss/main.min.33e67b67522abab078f32f1ef9432f9311c52c0a0aed6a9c7f75fedcb53af9be.css as=style><link href=/scss/main.min.33e67b67522abab078f32f1ef9432f9311c52c0a0aed6a9c7f75fedcb53af9be.css rel=stylesheet integrity><script src=https://code.jquery.com/jquery-3.5.1.min.js integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin=anonymous></script></head><body class=td-section><header><nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar"><a class=navbar-brand href=/><span class=navbar-logo><svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" width="30" height="30" viewBox="0 0 30 30" id="svg9" sodipodi:docname="logo.svg" inkscape:version="0.92.5 (2060ec1f9f, 2020-04-08)"><defs id="defs13"/><sodipodi:namedview pagecolor="#ffffff" bordercolor="#666666" borderopacity="1" objecttolerance="10" gridtolerance="10" guidetolerance="10" inkscape:pageopacity="0" inkscape:pageshadow="2" inkscape:window-width="1602" inkscape:window-height="871" id="namedview11" showgrid="false" inkscape:zoom="19.666667" inkscape:cx="25.549767" inkscape:cy="15.135206" inkscape:window-x="0" inkscape:window-y="27" inkscape:window-maximized="0" inkscape:current-layer="svg9"/><title id="title2">4135B303-CB0F-43C8-8C8F-225E46D3A3E3</title><g id="DS-Style-Guide" style="fill:none;fill-rule:evenodd;stroke:none;stroke-width:1" transform="matrix(0.41143082,0,0,0.41706694,-4.8865756,-5.012913)"><g id="DS-/-Style-Guide-/-Brand" transform="translate(-1323,-629)" style="fill:#e3e3e3"><g id="Atoms-/-Brand-/-Isotype-/-isotype-B-light" transform="translate(1323,629)"><g id="Atoms-/-Brand-/-Isotype-v4" transform="translate(17.361702,18.382979)"><path d="M39.392034.33851303C52.047353 4.0838212 61.27663 15.737809 61.27663 29.538647c0 16.82579-13.717447 30.466173-30.638298 30.466173C13.71714 60.00482 3.4042553e-5 46.364437 3.4042553e-5 29.538647 3.4042553e-5 15.737809 9.2293106 4.0838212 21.884289.33851303v0V9.5893971C14.155609 12.947446 8.7537362 20.615105 8.7537362 29.538647c0 12.018567 9.7981278 21.76131 21.8845958 21.76131 12.086468.0 21.884255-9.742743 21.884255-21.76131.0-8.923542-5.401532-16.591201-13.130553-19.9492499v0zM30.638332 20.833852c4.834383.0 8.753702 3.897301 8.753702 8.704863.0 4.807223-3.919319 8.704524-8.753702 8.704524-4.834724.0-8.754043-3.897301-8.754043-8.704524.0-4.807562 3.919319-8.704863 8.754043-8.704863z" id="Combined-Shape" inkscape:connector-curvature="0"/></g></g></g></g></svg></span><span class="text-uppercase font-weight-bold">Konstellation</span></a><div class="td-navbar-nav-scroll ml-md-auto" id=main_navbar><ul class="navbar-nav mt-2 mt-lg-0"><li class="nav-item mr-4 mb-2 mb-lg-0"><a class="nav-link active" href=/docs/><span class=active>Home</span></a></li></ul></div><div class="navbar-nav d-none d-lg-block"></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><div class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"><div id=td-sidebar-menu class=td-sidebar__inner><div id=content-mobile><form class="td-sidebar__search d-flex align-items-center"><button class="btn btn-link td-sidebar__toggle d-md-none p-0 ml-3 fas fa-bars" type=button data-toggle=collapse data-target=#td-section-nav aria-controls=td-docs-nav aria-expanded=false aria-label="Toggle section navigation"></button></form></div><div id=content-desktop></div><nav class="collapse td-sidebar-nav" id=td-section-nav><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/docs/ class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section">Home</a></li><ul><li class="collapse show" id=docs><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/docs/kre/ class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section">KAI Server</a></li><ul><li class="collapse show" id=docskre><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/docs/kre/getting_started/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Getting Started</a></li><ul><li class=collapse id=docskregetting_started><a class="td-sidebar-link td-sidebar-link__page" id=m-docskregetting_startedcore_concepts href=/docs/kre/getting_started/core_concepts/>Core concepts</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docskregetting_startedinstall_local href=/docs/kre/getting_started/install_local/>Run KAI Server</a></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/docs/kre/operator/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Operator documentation</a></li><ul><li class=collapse id=docskreoperator><a class="td-sidebar-link td-sidebar-link__page" id=m-docskreoperatorkais_architecture href=/docs/kre/operator/kais_architecture/>KAI Server Architecture</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docskreoperatorinstallation href=/docs/kre/operator/installation/>Install KAI Server</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docskreoperatorcustomization href=/docs/kre/operator/customization/>Customization</a></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/docs/kre/user/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">User documentation</a></li><ul><li class=collapse id=docskreuser><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/docs/kre/user/10_intro/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Intro</a></li><ul><li class=collapse id=docskreuser10_intro></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/docs/kre/user/20_projects/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Projects</a></li><ul><li class=collapse id=docskreuser20_projects></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/docs/kre/user/30_versions/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Project Versions</a></li><ul><li class=collapse id=docskreuser30_versions></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/docs/kre/user/40_krt/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">KRT</a></li><ul><li class=collapse id=docskreuser40_krt><a class="td-sidebar-link td-sidebar-link__page" id=m-docskreuser40_krtspecs href=/docs/kre/user/40_krt/specs/>KRT YAML specs</a></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/docs/kre/user/50_kais_runner_sdk/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">KAI Server Runner SDK</a></li><ul><li class=collapse id=docskreuser50_kais_runner_sdk></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/docs/kre/user/60_observavility/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Observability</a></li><ul><li class=collapse id=docskreuser60_observavility></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/docs/kre/user/70_features/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Features</a></li><ul><li class=collapse id=docskreuser70_features></li></ul></ul></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/docs/kre/training/ class="align-left pl-0 pr-2 active td-sidebar-link td-sidebar-link__section">KAI Server Training</a></li><ul><li class="collapse show" id=docskretraining></li></ul></ul></li></ul></ul></li></ul></ul></nav></div></div><div class="d-none d-xl-block col-xl-2 td-toc d-print-none"><div class="td-page-meta ml-2 pb-1 pt-2 mb-0"><a href=https://github.com/konstellation-io/website/edit/master/content/en/docs/KRE/training/_index.md target=_blank><i class="fa fa-edit fa-fw"></i>Edit this page</a>
<a href="https://github.com/konstellation-io/website/issues/new?title=KAI%20Server%20Training" target=_blank><i class="fab fa-github fa-fw"></i>Create documentation issue</a></div><nav id=TableOfContents><ul><li><a href=#introduction>Introduction</a></li><li><a href=#how-to-deploy>How to deploy</a></li><li><a href=#how-to-use>How to use</a></li><li><a href=#descriptor-example>Descriptor example</a><ul><li><a href=#result-example>Result example</a></li></ul></li><li><a href=#step-by-step-guide>Step-by-step guide</a><ul><li><a href=#1-create-the-version-structure-based-on-the-krt-template>1. Create the version structure based on the krt-template</a></li><li><a href=#2-fill-the-krtyml>2. Fill the <code>krt.yml</code></a></li><li><a href=#3-fill-the-protobuf-files>3. Fill the protobuf files</a></li><li><a href=#4-develop-the-nodes>4. Develop the nodes</a></li><li><a href=#5-build-the-krt-file>5. Build the .krt file</a></li><li><a href=#6-deploy-and-test-the-new-version>6. Deploy and test the new version</a></li></ul></li></ul></nav></div><main class="col-12 col-md-9 col-xl-8 pl-md-5" role=main><nav aria-label=breadcrumb class="d-none d-md-block d-print-none"><ol class="breadcrumb spb-1"><li class=breadcrumb-item><a href=https://www.konstellation.io/docs/>Home</a></li><li class=breadcrumb-item><a href=https://www.konstellation.io/docs/kre/>KAI Server</a></li><li class="breadcrumb-item active" aria-current=page><a href=https://www.konstellation.io/docs/kre/training/>KAI Server Training</a></li></ol></nav><div class=td-content><h1>KAI Server Training</h1><div class=lead>KAI Server Training Project</div><p>The <a href=https://github.com/konstellation-io/kai-server-training>Kai Server Training repo</a> is a training exercise designed
to introduce new users to the usage and development of KRT projects. You can use the training exercise to build and
deploy your first KRT project and also to reverse engineer it and learn how to develop your own projects.</p><h2 id=introduction>Introduction</h2><p>This example consists of a workflow called <em>Descriptor</em> that will print information of a given GitHub repository, being
this info its last GitHub and Dockerhub tag released. The workflow is made up of 3 different nodes, each one in charge
of a different process through the pipeline:</p><ul><li><strong>ETL</strong>: This node will accept incoming requests and prepare a new info struct to be filled.</li><li><strong>GitHub</strong>: This node will search for the GitHub information of the repo then fill the info struct with it if found.</li><li><strong>Dockerhub</strong>: This node will search for the Dockerhub information of the repo then fill the info struct with it if found.</li></ul><p>All nodes also save metrics to the InfluxDB instance as an example of metric handling.</p><h2 id=how-to-deploy>How to deploy</h2><p>You can find information about building and deployment within the repo&rsquo;s <code>readme</code> file.</p><h2 id=how-to-use>How to use</h2><p>Once deployed the generated KRT file, you can open an entrypoint to your local pod. However, to easy up usage, we&rsquo;ve
placed some helping scripts inside a folder called <code>scripts</code>, you can find information about usage within the <code>readme</code>
file placed inside this directory as well.</p><h2 id=descriptor-example>Descriptor example</h2><div class="card rounded p-2 td-post-card mb-4 mt-4" style=max-width:1010px><img class=card-img-top src=/docs/kre/training/kai-training-example_hua90e230fb7082f978b2864057d1fc7f2_74540_1000x0_resize_catmullrom_2.png width=1000 height=598></div><h3 id=result-example>Result example</h3><div class="card rounded p-2 td-post-card mb-4 mt-4" style=max-width:1010px><img class=card-img-top src=/docs/kre/training/kai-training-result-example_hu1dd8b0ca66cb84e1f146586f3b5ae250_41479_1000x0_resize_catmullrom_2.png width=1000 height=210></div><h2 id=step-by-step-guide>Step-by-step guide</h2><p>This step-by-step guide will aid you create a new Konstellation version for your project, which will help you understand
all the main KAI Server concepts and test KAI Server functions.</p><h3 id=1-create-the-version-structure-based-on-the-krt-template>1. Create the version structure based on the krt-template</h3><p>Start by creating an empty project with the following folders and files:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>   project
   └───docs   
   <span style=color:#000;font-weight:700>|</span>   └───README.md <span style=color:#8f5902;font-style:italic># Documentation shown inside KAI Server</span>
   │
   └───models    <span style=color:#8f5902;font-style:italic># If the process needs a model to do the inference</span>
   │   
   └───src       <span style=color:#8f5902;font-style:italic># Source code of each node</span>
   │   └───etl
   │   └───github
   │   └───dockerhub
   <span style=color:#000;font-weight:700>|</span>
   └─── metrics
   │   └───dashboards
   <span style=color:#000;font-weight:700>|</span>
   <span style=color:#000;font-weight:700>|</span>   krt.yml   <span style=color:#8f5902;font-style:italic># krt manifest</span>
   <span style=color:#000;font-weight:700>|</span>   public_input.proto    <span style=color:#8f5902;font-style:italic># proto defining entrypoint Services and Messages.</span>
   <span style=color:#000;font-weight:700>|</span>   internal_nodes.proto  <span style=color:#8f5902;font-style:italic># proto defining Messages that interconnect nodes.</span>
</code></pre></div><h3 id=2-fill-the-krtyml>2. Fill the <code>krt.yml</code></h3><p>More information can be found <a href=/docs/kre/user/40_krt/>here</a>.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>version</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span>descriptor-v2<span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>description</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span>Version<span style=color:#f8f8f8;text-decoration:underline> </span>for<span style=color:#f8f8f8;text-decoration:underline> </span>testing.<span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>entrypoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>proto</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span>public_input.proto<span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>image</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span>konstellation/kre-entrypoint<span style=color:#000;font-weight:700>:</span>latest<span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>config</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>variables</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>        </span>- GITHUB_ENABLED<span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>        </span>- DOCKERHUB_ENABLED<span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>nodes</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span>etl<span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>image</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span>konstellation/kre-go<span style=color:#000;font-weight:700>:</span>latest<span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>src</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span>bin/etl<span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#8f5902;font-style:italic># gpu is an optional value, defaults to false.</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>gpu</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>false</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span>github<span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>image</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span>konstellation/kre-go<span style=color:#000;font-weight:700>:</span>latest<span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>src</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span>bin/github<span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#8f5902;font-style:italic># gpu is an optional value, defaults to false.</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>gpu</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>false</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span>dockerhub<span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>image</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span>konstellation/kre-go<span style=color:#000;font-weight:700>:</span>latest<span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>src</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span>bin/dockerhub<span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#8f5902;font-style:italic># gpu is an optional value, defaults to false.</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>gpu</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>false</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>workflows</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span>go-descriptor<span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>entrypoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span>GoDescriptor<span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>sequential</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>          </span>- etl<span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>          </span>- github<span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>          </span>- dockerhub<span style=color:#f8f8f8;text-decoration:underline>
</span></code></pre></div><h3 id=3-fill-the-protobuf-files>3. Fill the protobuf files</h3><h4 id=public_inputproto>public_input.proto</h4><p>This file will be used to define the public nodes&rsquo; data contract and should contain the following info:</p><ul><li><code>Request</code> message: main entrypoint entrance.</li><li><code>GithubInfo</code> message: Data structure for the GitHub info.</li><li><code>DockerhubInfo</code> message: Data structure for the Dockerhub info.</li><li><code>Response</code> message: Final response.</li><li><code>Entrypoint</code> service that routes to the first node and returns a <code>Response</code> message.</li></ul><h4 id=internal_nodesproto>internal_nodes.proto</h4><p>This second protobuf file defines the data contract for the internal nodes. It follows the same approach of the <code>public_input.proto</code> file to generate the following resources:</p><ul><li><code>EtlOutput</code> message: Output of the ETL node.</li><li><code>GithubOutput</code> message: Output of the GitHub node.</li></ul><p>Keep in mind that in order to properly create the <code>GithubOutput</code> message, it&rsquo;s necessary to import the <code>GithubInfo</code> message from the <code>public_input.proto</code> file.</p><h3 id=4-develop-the-nodes>4. Develop the nodes</h3><p>Nodes are defined isolated from each other in the <code>src</code> directory.</p><ol><li>Create a new empty directory in <code>src</code></li></ol><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>mkdir node-name
</code></pre></div><ol start=2><li>Initialize the directory as Go project</li></ol><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>go mod init node-name
</code></pre></div><ol start=3><li>Create a <code>main.go</code> as the entrypoint of the code</li></ol><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>touch main.go
</code></pre></div><ol start=4><li>Define <code>init</code> and <code>handler</code> functions explained <a href=/docs/kre/user/50_kais_runner_sdk/>here</a></li></ol><p>The code inside a node can be organized in many ways to keep the best clean code practices, but the root directory
should have a <code>main.go</code> file with the <code>init</code> and <code>handler</code> functions.</p><p>As this training exercise is based in creating a GitHub and DockerHub descriptor (a tool to get what are the latest
versions updated to GitHub and DockerHub of a component.), it will be necessary to create the following nodes:</p><ul><li>ETL: This node is in charge of processing the data passed in the entrypoint and follows the structure below:</li></ul><pre><code>  etl     
  └───go.mod
  └───go.sum
  └───main.go
  └───public_input.pb.go
</code></pre><ul><li>GitHub: This node is in charge of checking the latest version of the selected Konstellation repository.</li></ul><pre><code>  github     
  └───dockerhubservice
  |   └───mocks_service.go
  |   └───service.go
  └───go.mod
  └───go.sum
  └───main.go
  └───main_test.go
  └───public_input.pb.go
</code></pre><ul><li>Dockerhub: This node is in charge of checking the latest image uploaded to the selected Dockerhub repository.</li></ul><pre><code>  dockerhub     
  └───dockerhubservice
  |   └───mocks_service.go
  |   └───service.go
  └───go.mod
  └───go.sum
  └───main.go
  └───main_test.go
  └───public_input.pb.go
</code></pre><p>After creating the nodes folders, the next step is to compile the protobuf files and generate the <code>public_input.proto</code>
file inside each node folder, using the following command:</p><pre><code>  protoc -I=./descriptor \
  --go_out=descriptor/src/etl \
  --go_out=descriptor/src/github \
  --go_out=descriptor/src/dockerhub \
  --go_opt=paths=source_relative descriptor/public_input.proto
</code></pre><p>Once the protobuf files are compiled, you can start coding the nodes.</p><blockquote><p>The full content of the nodes and protobuf files can be found <a href=https://github.com/konstellation-io/kai-server-training/tree/docs/descriptor/src>here</a></p></blockquote><h3 id=5-build-the-krt-file>5. Build the .krt file</h3><p>In order to upload a new version to the KAI Server, it&rsquo;s necessary to create a .krt file that contains all the required
files. This file can be created with the following script:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#8f5902;font-style:italic>#!/bin/bash
</span><span style=color:#8f5902;font-style:italic></span>
<span style=color:#8f5902;font-style:italic># shellcheck disable=SC2086</span>

<span style=color:#8f5902;font-style:italic>## USAGE:</span>
<span style=color:#8f5902;font-style:italic>#    ./build_krt.sh &lt;new-version-name&gt;</span>

<span style=color:#204a87>set</span> -eu

<span style=color:#000>VERSION_DIR</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;descriptor&#34;</span>

<span style=color:#8f5902;font-style:italic># NOTE: if yq commands fails it due to the awesome Snap installation that is confined (heavily restricted).</span>
<span style=color:#8f5902;font-style:italic># Please install yq binary from https://github.com/mikefarah/yq/releases and think twice before using Snap next time.</span>

<span style=color:#204a87>echo</span> -e <span style=color:#4e9a06>&#34;Reading current version: \c&#34;</span>
<span style=color:#000>CURRENT_VERSION</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#204a87;font-weight:700>$(</span>yq e .version <span style=color:#4e9a06>${</span><span style=color:#000>VERSION_DIR</span><span style=color:#4e9a06>}</span>/krt.yml<span style=color:#204a87;font-weight:700>)</span>

<span style=color:#204a87>echo</span> <span style=color:#4e9a06>&#34;</span><span style=color:#4e9a06>${</span><span style=color:#000>CURRENT_VERSION</span><span style=color:#4e9a06>}</span><span style=color:#4e9a06>&#34;</span>

<span style=color:#000>VERSION</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>${</span><span style=color:#000>VERSION_DIR</span><span style=color:#4e9a06>}</span>-<span style=color:#4e9a06>${</span><span style=color:#000>1</span><span style=color:#204a87;font-weight:700>:-</span><span style=color:#4e9a06>${</span><span style=color:#000>CURRENT_VERSION</span><span style=color:#000;font-weight:700>#</span><span style=color:#000>$VERSION_DIR</span><span style=color:#000;font-weight:700>-</span><span style=color:#4e9a06>}}</span>

<span style=color:#204a87;font-weight:700>if</span> <span style=color:#ce5c00;font-weight:700>[</span> -z <span style=color:#4e9a06>&#34;</span><span style=color:#000>$VERSION</span><span style=color:#4e9a06>&#34;</span> <span style=color:#ce5c00;font-weight:700>]</span><span style=color:#000;font-weight:700>;</span> <span style=color:#204a87;font-weight:700>then</span>
  <span style=color:#204a87>echo</span> <span style=color:#4e9a06>&#34;error setting KRT version&#34;</span>
  <span style=color:#204a87>exit</span> 1<span style=color:#000;font-weight:700>;</span>
<span style=color:#204a87;font-weight:700>fi</span>

<span style=color:#204a87>echo</span> <span style=color:#4e9a06>&#34;Building ETL node Golang binary...&#34;</span>
<span style=color:#204a87>cd</span> descriptor/src/etl
go build -o ../../bin/etl .

<span style=color:#204a87>echo</span> <span style=color:#4e9a06>&#34;Building Github node Golang binary...&#34;</span>
<span style=color:#204a87>cd</span> ../github
go build -o ../../bin/github .

<span style=color:#204a87>echo</span> <span style=color:#4e9a06>&#34;Building Dockerhub node Golang binary...&#34;</span>
<span style=color:#204a87>cd</span> ../dockerhub
go build -o ../../bin/dockerhub .
<span style=color:#204a87>cd</span> ../../..


<span style=color:#204a87>echo</span> <span style=color:#4e9a06>&#34;Generating </span><span style=color:#000>$VERSION</span><span style=color:#4e9a06>.krt...&#34;</span>

mkdir -p build/<span style=color:#4e9a06>${</span><span style=color:#000>VERSION_DIR</span><span style=color:#4e9a06>}</span>
rm ./build/<span style=color:#4e9a06>${</span><span style=color:#000>VERSION_DIR</span><span style=color:#4e9a06>}</span>/<span style=color:#ce5c00;font-weight:700>{</span>docs,src,assets,models,*.proto,*.yml<span style=color:#ce5c00;font-weight:700>}</span> -rf

<span style=color:#204a87>cd</span> build/<span style=color:#4e9a06>${</span><span style=color:#000>VERSION_DIR</span><span style=color:#4e9a06>}</span>

cp  -r ../../<span style=color:#4e9a06>${</span><span style=color:#000>VERSION_DIR</span><span style=color:#4e9a06>}</span>/* .

yq <span style=color:#204a87>eval</span> --inplace -- <span style=color:#4e9a06>&#34;.version = \&#34;</span><span style=color:#4e9a06>${</span><span style=color:#000>VERSION</span><span style=color:#4e9a06>}</span><span style=color:#4e9a06>\&#34;&#34;</span> ./krt.yml

tar -zcf ../<span style=color:#4e9a06>${</span><span style=color:#000>VERSION</span><span style=color:#4e9a06>}</span>.krt  --exclude<span style=color:#ce5c00;font-weight:700>=</span>*.krt --exclude<span style=color:#ce5c00;font-weight:700>=</span>*.tar.gz *
<span style=color:#204a87>cd</span> ../../
rm  build/<span style=color:#4e9a06>${</span><span style=color:#000>VERSION_DIR</span><span style=color:#4e9a06>}</span> -rf

<span style=color:#204a87>echo</span> <span style=color:#4e9a06>&#34;Done&#34;</span>
</code></pre></div><h3 id=6-deploy-and-test-the-new-version>6. Deploy and test the new version</h3><p>Once the .krt file is created, it can be uploaded to KAI Server.</p><figure><img src=/docs/static/upload_version.png width=1000px></figure><p>Finally, in order to test the new version, you can use the <a href>run_test.sh</a> script as follows:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>run_test.sh &lt;NAMESPACE&gt; &lt;VERSION_NAME&gt; &lt;WORKFLOW&gt; &lt;NUM_MSGS&gt; &lt;REQUESTED_COMPONENT&gt;
</code></pre></div><p><strong>Example</strong>: For our namespace <code>kre</code> and a krt version <code>descriptor-v1</code>, you can try out these commands:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>./scripts/run_test.sh kre descriptor-v1 GoDescriptor <span style=color:#0000cf;font-weight:700>1</span> konstellation-io/kre
./scripts/run_test.sh kre descriptor-v1 GoDescriptor <span style=color:#0000cf;font-weight:700>1</span> konstellation-io/kdl-server
</code></pre></div><div class=section-index><hr class=panel-line></div><div class="text-muted mt-5 pt-3 border-top">Last modified April 26, 2022: <a href=https://github.com/konstellation-io/website/commit/287b38768b017777d1c06e34ab5cca5b9653788e>fix pr suggestions (287b387)</a></div></div></main></div></div><footer class="bg-dark py-5 row d-print-none"><div class="container-fluid mx-sm-5"><div class=row><div class="col-6 col-sm-4 text-xs-center order-sm-2"></div><div class="col-6 col-sm-4 text-right text-xs-center order-sm-3"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=GitHub aria-label=GitHub><a class=text-white target=_blank href=https://github.com/konstellation-io/kre><i class="fab fa-github"></i></a></li></ul></div><div class="col-12 col-sm-4 text-center py-2 order-sm-2"><small class=text-white>&copy; 2022 The Konstellation Authors All Rights Reserved</small></div></div></div></footer></div><script src=https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js integrity=sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49 crossorigin=anonymous></script><script src=https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js integrity=sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy crossorigin=anonymous></script><script src=/js/main.min.a34f6fe6e1caad9ee74f246a8f19857e3b99c2008bc2813ea4940235123bbc5e.js integrity="sha256-o09v5uHKrZ7nTyRqjxmFfjuZwgCLwoE+pJQCNRI7vF4=" crossorigin=anonymous></script></body></html>
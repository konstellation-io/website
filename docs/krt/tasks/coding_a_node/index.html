<!doctype html><html lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.74.3"><meta name=ROBOTS content="NOINDEX, NOFOLLOW"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/website/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/website/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/website/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/website/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/website/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/website/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/website/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/website/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/website/favicons/android-192x192.png sizes=192x192><title>Coding a node | Konstellation</title><meta property="og:title" content="Coding a node"><meta property="og:description" content="An example of how to code a node."><meta property="og:type" content="article"><meta property="og:url" content="https://konstellation-io.github.io/website/docs/krt/tasks/coding_a_node/"><meta property="article:modified_time" content="2020-08-17T12:52:21+02:00"><meta property="og:site_name" content="Konstellation"><meta itemprop=name content="Coding a node"><meta itemprop=description content="An example of how to code a node."><meta itemprop=dateModified content="2020-08-17T12:52:21+02:00"><meta itemprop=wordCount content="792"><meta itemprop=keywords content><meta name=twitter:card content="summary"><meta name=twitter:title content="Coding a node"><meta name=twitter:description content="An example of how to code a node."><link rel=preload href=/website/scss/main.min.33e67b67522abab078f32f1ef9432f9311c52c0a0aed6a9c7f75fedcb53af9be.css as=style><link href=/website/scss/main.min.33e67b67522abab078f32f1ef9432f9311c52c0a0aed6a9c7f75fedcb53af9be.css rel=stylesheet integrity><script src=https://code.jquery.com/jquery-3.5.1.min.js integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin=anonymous></script></head><body class=td-page><header><nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar"><a class=navbar-brand href=/website/><span class=navbar-logo><svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" width="30" height="30" viewBox="0 0 30 30" id="svg9" sodipodi:docname="logo.svg" inkscape:version="0.92.5 (2060ec1f9f, 2020-04-08)"><defs id="defs13"/><sodipodi:namedview pagecolor="#ffffff" bordercolor="#666666" borderopacity="1" objecttolerance="10" gridtolerance="10" guidetolerance="10" inkscape:pageopacity="0" inkscape:pageshadow="2" inkscape:window-width="1602" inkscape:window-height="871" id="namedview11" showgrid="false" inkscape:zoom="19.666667" inkscape:cx="25.549767" inkscape:cy="15.135206" inkscape:window-x="0" inkscape:window-y="27" inkscape:window-maximized="0" inkscape:current-layer="svg9"/><title id="title2">4135B303-CB0F-43C8-8C8F-225E46D3A3E3</title><g id="DS-Style-Guide" style="fill:none;fill-rule:evenodd;stroke:none;stroke-width:1" transform="matrix(0.41143082,0,0,0.41706694,-4.8865756,-5.012913)"><g id="DS-/-Style-Guide-/-Brand" transform="translate(-1323,-629)" style="fill:#e3e3e3"><g id="Atoms-/-Brand-/-Isotype-/-isotype-B-light" transform="translate(1323,629)"><g id="Atoms-/-Brand-/-Isotype-v4" transform="translate(17.361702,18.382979)"><path d="M39.392034.33851303C52.047353 4.0838212 61.27663 15.737809 61.27663 29.538647c0 16.82579-13.717447 30.466173-30.638298 30.466173C13.71714 60.00482 3.4042553e-5 46.364437 3.4042553e-5 29.538647 3.4042553e-5 15.737809 9.2293106 4.0838212 21.884289.33851303v0V9.5893971C14.155609 12.947446 8.7537362 20.615105 8.7537362 29.538647c0 12.018567 9.7981278 21.76131 21.8845958 21.76131 12.086468.0 21.884255-9.742743 21.884255-21.76131.0-8.923542-5.401532-16.591201-13.130553-19.9492499v0zM30.638332 20.833852c4.834383.0 8.753702 3.897301 8.753702 8.704863.0 4.807223-3.919319 8.704524-8.753702 8.704524-4.834724.0-8.754043-3.897301-8.754043-8.704524.0-4.807562 3.919319-8.704863 8.754043-8.704863z" id="Combined-Shape" inkscape:connector-curvature="0"/></g></g></g></g></svg></span><span class="text-uppercase font-weight-bold">Konstellation</span></a><div class="td-navbar-nav-scroll ml-md-auto" id=main_navbar><ul class="navbar-nav mt-2 mt-lg-0"><li class="nav-item mr-4 mb-2 mb-lg-0"><a class="nav-link active" href=/website/docs/><span class=active>Documentation</span></a></li></ul></div><div class="navbar-nav d-none d-lg-block"></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><div class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"><div id=td-sidebar-menu class=td-sidebar__inner><div id=content-mobile><form class="td-sidebar__search d-flex align-items-center"><button class="btn btn-link td-sidebar__toggle d-md-none p-0 ml-3 fas fa-bars" type=button data-toggle=collapse data-target=#td-section-nav aria-controls=td-docs-nav aria-expanded=false aria-label="Toggle section navigation"></button></form></div><div id=content-desktop></div><nav class="collapse td-sidebar-nav" id=td-section-nav><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/website/docs/ class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section">Documentation</a></li><ul><li class="collapse show" id=websitedocs><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/website/docs/overview/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Overview</a></li><ul><li class=collapse id=websitedocsoverview></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/website/docs/krt/ class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section">Runtime Transport (KRT)</a></li><ul><li class="collapse show" id=websitedocskrt><a class="td-sidebar-link td-sidebar-link__page" id=m-websitedocskrtconcepts href=/website/docs/krt/concepts/>Concepts</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-websitedocskrtspecs href=/website/docs/krt/specs/>KRT YAML specs</a><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/website/docs/krt/tasks/ class="align-left pl-0 pr-2 active td-sidebar-link td-sidebar-link__section">Tasks</a></li><ul><li class="collapse show" id=websitedocskrttasks><a class="td-sidebar-link td-sidebar-link__page" id=m-websitedocskrttasksdefine_krt_yml href=/website/docs/krt/tasks/define_krt_yml/>Define a krt.yml file</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-websitedocskrttaskscreate_an_entrypoint href=/website/docs/krt/tasks/create_an_entrypoint/>Create an Entrypoint</a>
<a class="td-sidebar-link td-sidebar-link__page active" id=m-websitedocskrttaskscoding_a_node href=/website/docs/krt/tasks/coding_a_node/>Coding a node</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-websitedocskrttaskscreate_krt_file href=/website/docs/krt/tasks/create_krt_file/>Create a KRT</a></li></ul></ul></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/website/docs/kre/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Runtime Engine (KRE)</a></li><ul><li class=collapse id=websitedocskre><a class="td-sidebar-link td-sidebar-link__page" id=m-websitedocskreconcepts href=/website/docs/kre/concepts/>Concepts</a><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/website/docs/kre/installation/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Installation</a></li><ul><li class=collapse id=websitedocskreinstallation><a class="td-sidebar-link td-sidebar-link__page" id=m-websitedocskreinstallationhelm href=/website/docs/kre/installation/helm/>Helm basics</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-websitedocskreinstallationgke href=/website/docs/kre/installation/gke/>GKE</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-websitedocskreinstallationminikube href=/website/docs/kre/installation/minikube/>Minikube</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-websitedocskreinstallationeks href=/website/docs/kre/installation/eks/>EKS</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-websitedocskreinstallationvalidate href=/website/docs/kre/installation/validate/>Validate</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-websitedocskreinstallationcustomization href=/website/docs/kre/installation/customization/>Customization</a></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/website/docs/kre/tasks/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Tasks</a></li><ul><li class=collapse id=websitedocskretasks><a class="td-sidebar-link td-sidebar-link__page" id=m-websitedocskretaskslogin href=/website/docs/kre/tasks/login/>Login</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-websitedocskretaskscreate_runtime href=/website/docs/kre/tasks/create_runtime/>Create runtime</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-websitedocskretaskscreate_version href=/website/docs/kre/tasks/create_version/>Create version</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-websitedocskretasksversion_management href=/website/docs/kre/tasks/version_management/>Version Management</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-websitedocskretasksconsume_version_services href=/website/docs/kre/tasks/consume_version_services/>Call Version Services</a></li></ul></ul></li></ul></ul></li></ul></ul></nav></div></div><div class="d-none d-xl-block col-xl-2 td-toc d-print-none"><div class="td-page-meta ml-2 pb-1 pt-2 mb-0"><a href=https://github.com/konstellation-io/website/edit/master/content/en/docs/KRT/tasks/coding_a_node/index.md target=_blank><i class="fa fa-edit fa-fw"></i>Edit this page</a>
<a href="https://github.com/konstellation-io/website/issues/new?title=Coding%20a%20node" target=_blank><i class="fab fa-github fa-fw"></i>Create documentation issue</a></div><nav id=TableOfContents><ul><li><a href=#python>Python</a><ul><li><a href=#init-handler>Init handler</a></li><li><a href=#message-handler>Message handler</a></li></ul></li><li><a href=#golang>Golang</a><ul><li><a href=#init-handler-1>Init handler</a></li><li><a href=#message-handler-1>Message handler</a></li><li><a href=#start-the-runner>Start the runner</a></li></ul></li></ul></nav></div><main class="col-12 col-md-9 col-xl-8 pl-md-5" role=main><nav aria-label=breadcrumb class="d-none d-md-block d-print-none"><ol class="breadcrumb spb-1"><li class=breadcrumb-item><a href=https://konstellation-io.github.io/website/docs/>Documentation</a></li><li class=breadcrumb-item><a href=https://konstellation-io.github.io/website/docs/krt/>Runtime Transport (KRT)</a></li><li class=breadcrumb-item><a href=https://konstellation-io.github.io/website/docs/krt/tasks/>Tasks</a></li><li class="breadcrumb-item active" aria-current=page><a href=https://konstellation-io.github.io/website/docs/krt/tasks/coding_a_node/>Coding a node</a></li></ol></nav><div class=td-content><h1>Coding a node</h1><div class=lead>An example of how to code a node.</div><p>Here you will learn how to program a node in different languages.
Currently, KRE supports Python and Golang with an SDK that provides ways to receive, process and send messages on each
node.</p><p>With the SDK you can implement the main two handler functions that a node needs. One optional function for
initialization, and one message handler function that will be the core of your node.</p><p>Both these functions, <code>init</code> and <code>handler</code>, has an input parameter that is a shared context, and contains tools to
interact with KRE, store data, share memory values, etc.</p><h2 id=python>Python</h2><p>In Python your code will be dynamically loaded into the runner. The runner will look for functions with the following
signature <code>init(ctx)</code> and <code>handler(ctx, data)</code>. Both handlers are defined as async functions to enable the possibility
of performing async tasks.</p><p>In this example we are creating a node that make predictions with a model that is included on your KRT file. You can
use the init function to load the model, so you only load it once to memory, and then use it for each incoming message
this node would get.</p><h3 id=init-handler>Init handler</h3><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>joblib</span>

<span style=color:#000>async</span> <span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>init</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>ctx</span><span style=color:#000;font-weight:700>):</span>
    <span style=color:#000>ctx</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>logger</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>info</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;[worker init]&#34;</span><span style=color:#000;font-weight:700>)</span>
    <span style=color:#000>ctx</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>set</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;model&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>joblib</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>load</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>ctx</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>path</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;models/model.joblib&#39;</span><span style=color:#000;font-weight:700>)))</span>
</code></pre></div><p>The function signature is <code>init(ctx)</code>. The context object have methods for logging and storing data that you
can later use on your message handler. It doesn&rsquo;t need any return value.</p><p>Note that <code>models/model.joblib</code> must be included in your KRT file with this same relative path.
Check <a href=/website/docs/krt/tasks/create_krt_file/>how to create a KRT file</a> for more info.</p><h3 id=message-handler>Message handler</h3><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>pandas</span> <span style=color:#204a87;font-weight:700>as</span> <span style=color:#000>pd</span>

<span style=color:#000>async</span> <span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>handler</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>ctx</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>data</span><span style=color:#000;font-weight:700>):</span>
    <span style=color:#000>ctx</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>logger</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>info</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;message received&#34;</span><span style=color:#000;font-weight:700>)</span>

    <span style=color:#8f5902;font-style:italic># Create a dataframe from input dict</span>
    <span style=color:#000>df</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>pd</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>DataFrame</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>from_dict</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>data</span><span style=color:#000;font-weight:700>)</span>

    <span style=color:#8f5902;font-style:italic># Access pre-loaded data from context loaded on init() function </span>
    <span style=color:#000>model</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>ctx</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>get</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;model&#39;</span><span style=color:#000;font-weight:700>)</span>

    <span style=color:#8f5902;font-style:italic># Run a prediction</span>
    <span style=color:#000>ctx</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>logger</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>info</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;running prediction&#39;</span><span style=color:#000;font-weight:700>)</span>
    <span style=color:#000>prediction</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>model</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>predict</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>df</span><span style=color:#000;font-weight:700>)</span>

    <span style=color:#8f5902;font-style:italic># Return prediction value as a JSON serializable object</span>
    <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000;font-weight:700>{</span><span style=color:#4e9a06>&#39;price_category&#39;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000>prediction</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>item</span><span style=color:#000;font-weight:700>()}</span>
</code></pre></div><p>The message handler signature is <code>handler(ctx, data)</code>. The context object is the same from the init handler and is also
shared between different executions. You can <code>set/get</code> data from its internal registry to store any value.</p><p>Note that the <strong>return value must be a JSON serializable object</strong> for KRE to process it correctly.</p><h2 id=golang>Golang</h2><p>KRE provides support for nodes running Golang code, but currently you need to compile the binary before generating the
KRT file. This may be also automated in future releases.</p><p>Compile your binary for the architecture you need (amd/arm) and reference the resulting binary from your <code>krt.yml</code>.
Check <a href=/website/docs/krt/tasks/create_krt_file/>how to create a KRT file</a> for more info.</p><p>The SDK is provided as a library that you can import in your code as <code>github.com/konstellation-io/kre/runners/kre-go</code>.</p><p>You need to ctea The runner will look for functions with the following
signature <code>init(ctx)</code> and <code>handler(ctx, data)</code>. Both handlers are defined as async functions to enable the possibility
of performing async tasks.</p><h3 id=init-handler-1>Init handler</h3><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#204a87;font-weight:700>package</span> <span style=color:#000>main</span>

<span style=color:#204a87;font-weight:700>import</span> <span style=color:#000;font-weight:700>(</span>
	<span style=color:#4e9a06>&#34;github.com/konstellation-io/kre/runners/kre-go&#34;</span>
<span style=color:#000;font-weight:700>)</span>

<span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>handlerInit</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>ctx</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>kre</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>HandlerContext</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
	<span style=color:#000>ctx</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Logger</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Info</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;init handler&#34;</span><span style=color:#000;font-weight:700>)</span>
    
    <span style=color:#8f5902;font-style:italic>// Saves a value in the context internal registry
</span><span style=color:#8f5902;font-style:italic></span>	<span style=color:#000>ctx</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Set</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;greeting&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;Hello&#34;</span><span style=color:#000;font-weight:700>)</span>   
<span style=color:#000;font-weight:700>}</span>
</code></pre></div><p>The function signature is <code>handlerInit(ctx)</code>. The context object have methods for logging and storing data that you
can later use on your message handler. It doesn&rsquo;t need any return value.</p><p>NOTE: <code>handlerInit</code> is mandatory even if you don&rsquo;t need to do any initialization code. The function needs to be defined
in order to invoke <code>kre.Start()</code> later.</p><h3 id=message-handler-1>Message handler</h3><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>handler</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>ctx</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>kre</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>HandlerContext</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>data</span> <span style=color:#000;font-weight:700>[]</span><span style=color:#204a87;font-weight:700>byte</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>interface</span><span style=color:#000;font-weight:700>{},</span> <span style=color:#204a87;font-weight:700>error</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
	<span style=color:#000>ctx</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Logger</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Info</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;message received&#34;</span><span style=color:#000;font-weight:700>)</span>

    <span style=color:#8f5902;font-style:italic>// Decode input data into your input message struct.
</span><span style=color:#8f5902;font-style:italic></span>	<span style=color:#000>input</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>Input</span><span style=color:#000;font-weight:700>{}</span>
	<span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>json</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Unmarshal</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>data</span><span style=color:#000;font-weight:700>,</span> <span style=color:#ce5c00;font-weight:700>&amp;</span><span style=color:#000>input</span><span style=color:#000;font-weight:700>)</span>
	<span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>!=</span> <span style=color:#204a87;font-weight:700>nil</span> <span style=color:#000;font-weight:700>{</span>
		<span style=color:#204a87;font-weight:700>return</span> <span style=color:#204a87;font-weight:700>nil</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>err</span>
	<span style=color:#000;font-weight:700>}</span>

    <span style=color:#8f5902;font-style:italic>// Here you can do any transformation to your data.
</span><span style=color:#8f5902;font-style:italic></span>	<span style=color:#000>greetingText</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>fmt</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Sprintf</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;%s %s!&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>ctx</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Get</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;greeting&#34;</span><span style=color:#000;font-weight:700>),</span> <span style=color:#000>input</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Name</span><span style=color:#000;font-weight:700>)</span>
	<span style=color:#000>ctx</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Logger</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Info</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>greetingText</span><span style=color:#000;font-weight:700>)</span>

    <span style=color:#8f5902;font-style:italic>// Prepare and return the output message.
</span><span style=color:#8f5902;font-style:italic></span>	<span style=color:#000>out</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>Output</span><span style=color:#000;font-weight:700>{}</span>
	<span style=color:#000>out</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Greeting</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>greetingText</span>
	<span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>out</span><span style=color:#000;font-weight:700>,</span> <span style=color:#204a87;font-weight:700>nil</span> <span style=color:#8f5902;font-style:italic>// Must be a serializable JSON.
</span><span style=color:#8f5902;font-style:italic></span><span style=color:#000;font-weight:700>}</span>

<span style=color:#8f5902;font-style:italic>// Input struct used to Unmarshal incoming []byte to the message handler.
</span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>type</span> <span style=color:#000>Input</span> <span style=color:#204a87;font-weight:700>struct</span> <span style=color:#000;font-weight:700>{</span>
	<span style=color:#000>Name</span> <span style=color:#204a87;font-weight:700>string</span> <span style=color:#4e9a06>`json:&#34;name&#34;`</span>
<span style=color:#000;font-weight:700>}</span>

<span style=color:#8f5902;font-style:italic>// Output struct used as return value in message handler. 
</span><span style=color:#8f5902;font-style:italic>// It will be then serialized by the SDK before sending it to next node.  
</span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>type</span> <span style=color:#000>Output</span> <span style=color:#204a87;font-weight:700>struct</span> <span style=color:#000;font-weight:700>{</span>
	<span style=color:#000>Greeting</span> <span style=color:#204a87;font-weight:700>string</span> <span style=color:#4e9a06>`json:&#34;greeting&#34;`</span>
<span style=color:#000;font-weight:700>}</span>

</code></pre></div><p>The message handler signature is <code>handler(ctx *kre.HandlerContext, data []byte) (interface{}, error) </code>. The context
object is the same from the init handler and is also shared between different executions. You can <code>set/get</code> data from
its internal registry to store any value.</p><p>Data input to the handler function is passed as <code>[]byte</code>. You need to define an input and output structs that will be
used to unmarshal input messages and used as response.</p><p>Note that the <strong>return value must be a JSON serializable object</strong> for KRE to process it correctly.</p><h3 id=start-the-runner>Start the runner</h3><p>In your main function call the SDK <code>Start</code> method passing both handlers you defined above:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>main</span><span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>{</span>
	<span style=color:#000>kre</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Start</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>handlerInit</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>handler</span><span style=color:#000;font-weight:700>)</span>
<span style=color:#000;font-weight:700>}</span>
</code></pre></div><div class="text-muted mt-5 pt-3 border-top">Last modified August 17, 2020: <a href=https://github.com/konstellation-io/website/commit/d33438942a63ccf60533914291fbabf31d9742b8>add python and golang code. (d334389)</a></div></div></main></div></div><footer class="bg-dark py-5 row d-print-none"><div class="container-fluid mx-sm-5"><div class=row><div class="col-6 col-sm-4 text-xs-center order-sm-2"></div><div class="col-6 col-sm-4 text-right text-xs-center order-sm-3"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=GitHub aria-label=GitHub><a class=text-white target=_blank href=https://github.com/konstellation-io/kre><i class="fab fa-github"></i></a></li></ul></div><div class="col-12 col-sm-4 text-center py-2 order-sm-2"><small class=text-white>&copy; 2020 The Konstellation Authors All Rights Reserved</small></div></div></div></footer></div><script src=https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js integrity=sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49 crossorigin=anonymous></script><script src=https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js integrity=sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy crossorigin=anonymous></script><script src=/website/js/main.min.b9195968a6c6ab09d066a0265a4d18503656ea780803ae5bf4ae83f9edc7b937.js integrity="sha256-uRlZaKbGqwnQZqAmWk0YUDZW6ngIA65b9K6D+e3HuTc=" crossorigin=anonymous></script></body></html>